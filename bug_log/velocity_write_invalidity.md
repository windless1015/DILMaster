# IBM 模拟不稳定问题的修复总结

本文档总结了为解决 `ibm_capsule3d_st_translate` 模拟中出现的“速度场全红”（数值爆炸/饱和）及“无有效数据写入”问题所做的关键修改。

## 1. 问题现象回顾
- **速度场全红**：流体速度达到格子速度极限（1.0），导致可视化结果呈现均匀的红色或蓝色，且无物理意义。
- **阻力爆炸**：诊断日志显示阻力（Drag）达到 `10^3` 甚至 `NaN` 级别。
- **原因**：IBM (浸入边界法) 的力反馈计算过于剧烈，导致流体求解器（LBM）瞬间发散。

## 2. 关键修复点 (Parameter Tuning)

我们主要通过调整三个核心参数来“驯服”模拟，使其从发散转为稳定：

### A. 降低松弛因子 (`beta`) —— 最关键的修复
*   **修改前**：`beta = 0.5`
*   **修改后**：`beta = 0.05`
*   **作用**：`beta` 决定了固体对流体的“硬度”。
    *   `0.5` 太硬，意味着试图在一步内完全修正速度差，这在目前的显式迭代求解器中导致了严重的过冲（Overshoot）和震荡。
    *   降至 `0.05` 意味着每一步只修正 5% 的速度差，通过多步累积来达成目标。这极大地软化了力的施加，**彻底消除了“爆炸”的根源**。

### B. 降低迭代次数 (`mdf_iter`)
*   **修改前**：`mdf_iter = 5` 或 `10`
*   **修改后**：`mdf_iter = 2`
*   **作用**：多重直接力法（MDF）通过迭代来提高精度。但在系统刚性过大时，过多的迭代会放大误差震荡。
    *   减少迭代次数虽然牺牲了单步的紧密耦合度（导致了后来的“滞后”），但它切断了误差放大的回路，确保了基本的数值稳定性。

### C. 降低特征速度 (`U0`)
*   **修改前**：`U0 = 0.05`
*   **修改后**：`U0 = 0.02`
*   **作用**：LBM 方法是弱可压缩的，要求马赫数（Ma = U/Cs）必须很小。
    *   降低物体运动速度 `U0` 减小了对流场的初始扰动冲击，使系统更容易处于线性稳定区。

### D. 消除噪声与泄漏 (Refinement)
虽然上述三点解决了“爆炸”，但为了得到平滑的有效数据，我们还做了以下调整：
*   **增加粘度 (`tau`)**：从 `0.8` 提至 `1.1`。物理粘度的增加抑制了高频数值噪声（棋盘格纹）。
*   **加密标记点 (`spacing`)**：从 `1.3` 恢复至 `1.0`。此前稀疏的采样导致流体从胶囊缝隙中“漏”过去，造成了非物理的高速射流；加密后堵住了漏洞，使流场形态恢复正常。

## 3. 总结
**“全红”问题的核心是参数设置导致的数值稳定性问题，而非代码逻辑错误。** 通过大幅降低刚性参数 (`beta`) 和初始冲击 (`U0`)，我们成功让求解器收敛，从而能够计算并写入有效的流场数据。
